<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Meu Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="./style.css" />
</head>
<body class="app">
  <div class="app-shell">
    <!-- Sidebar Esquerda -->
    <aside class="sidebar">
      <header class="sidebar-header">
        <div class="me">
          <div class="avatar" id="meAvatar">ðŸ‘¤</div>
          <div class="me-info">
            <div class="me-name" id="meName">...</div>
            <div class="me-username" id="meUsername">@...</div>
          </div>
        </div>
        <button id="btnLogout" class="btn-ghost" title="Sair">âŽ‹</button>
      </header>

      <div class="sidebar-search">
        <input id="searchInput" placeholder="Pesquisar ou comeÃ§ar nova conversa" />
        <button id="btnNewChat" title="Novo chat">ï¼‹</button>
      </div>

      <nav class="sidebar-tabs">
        <button class="tab active" data-tab="conversas">Conversas</button>
        <button class="tab" data-tab="arquivadas">Arquivadas</button>
        <button class="tab" data-tab="grupos">Grupos</button>
      </nav>

      <div class="sidebar-list" id="listConversas"></div>
      <div class="sidebar-list hidden" id="listArquivadas"></div>

      <div class="sidebar-groups hidden" id="groupsPane">
        <div class="group-create">
          <input id="groupName" placeholder="Nome do grupo" />
          <input id="groupMembers" placeholder="Usernames separados por vÃ­rgula" />
          <button id="btnCreateGroup" class="btn-primary">Criar grupo</button>
        </div>
        <div class="sidebar-list" id="listGrupos"></div>
      </div>
    </aside>

    <!-- Painel de Conversa -->
    <main class="chat">
      <header class="chat-header">
        <div class="chat-peer">
          <div class="avatar" id="peerAvatar">ðŸ’¬</div>
          <div>
            <div class="peer-name" id="peerName">Selecione uma conversa</div>
            <div class="peer-sub" id="peerSub"></div>
          </div>
        </div>
        <div class="chat-actions">
          <button id="btnArchive" class="btn-ghost" title="Arquivar/Desarquivar">ðŸ“¦</button>
        </div>
      </header>

      <section class="chat-messages" id="messages"></section>

      <form id="messageForm" class="chat-input">
        <input id="messageText" placeholder="Digite uma mensagem" autocomplete="off" />
        <button class="btn-primary">Enviar</button>
      </form>
    </main>
  </div>

  <script type="module" src="./app.js"></script>
  <script type="module">
    import {
      ensureLoggedIn,
      loadMe,
      onTabChange,
      openNewChatPrompt,
      listenConversations,
      listenArchived,
      listenGroups,
      openDirectChat,
      openGroupChat,
      sendMessage,
      toggleArchive,
      logout
    } from './app.js';

    // Se nÃ£o estiver logado, volta para login
    ensureLoggedIn();

    // Dados do usuÃ¡rio atual na UI
    loadMe({
      nameEl: document.getElementById('meName'),
      usernameEl: document.getElementById('meUsername'),
    });

    // Tabs
    document.querySelectorAll('.tab').forEach(btn => {
      btn.addEventListener('click', () => onTabChange(btn.dataset.tab));
    });

    // AÃ§Ãµes
    document.getElementById('btnNewChat').addEventListener('click', openNewChatPrompt);
    document.getElementById('btnLogout').addEventListener('click', logout);
    document.getElementById('btnCreateGroup').addEventListener('click', () => {
      // handled inside app.js (listener attached there)
    });

    // Listeners de listas
    listenConversations(document.getElementById('listConversas'), openDirectChat);
    listenArchived(document.getElementById('listArquivadas'), openDirectChat);
    listenGroups(document.getElementById('listGrupos'), openGroupChat);

    // Enviar mensagens
    const form = document.getElementById('messageForm');
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const text = document.getElementById('messageText').value.trim();
      if (!text) return;
      await sendMessage(text);
      document.getElementById('messageText').value = '';
    });

    // Arquivar
    document.getElementById('btnArchive').addEventListener('click', toggleArchive);
  </script>
</body>
</html>
